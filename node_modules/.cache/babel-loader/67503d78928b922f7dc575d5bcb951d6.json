{"ast":null,"code":"var _jsxFileName = \"/home/pratik/Downloads/crowdfunder/src/components/requests/list.js\";\nimport React, { Component } from \"react\";\nimport { Button, Table, Grid, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\"; //import Layout from '../layout';\n\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nexport default class CampaignsRequests extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      status: {}\n    };\n\n    this.closeModal = () => this.setState({\n      privateKeyModal: false\n    });\n\n    this.onApprove = async index => {\n      this.setState({\n        success: false\n      });\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        console.log(\"Private Key Null\");\n        this.setState({\n          privateKeyModal: true\n        });\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      let loading = this.state.loading;\n      loading.approve[index] = true;\n      this.setState({\n        error: \"\",\n        loading: loading,\n        waiting: true,\n        message: \"Approving\"\n      });\n\n      try {\n        const approveRequest = await this.campaign.methods.approveRequest(index);\n        const options = {\n          to: approveRequest._parent._address,\n          data: approveRequest.encodeABI(),\n          gas: \"1000000\"\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      loading.approve[index] = false;\n      this.setState({\n        loading,\n        waiting: false\n      });\n    };\n\n    this.onContribute = async index => {\n      this.setState({\n        success: false\n      });\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        this.setState({\n          privateKeyModal: true\n        });\n        console.log(\"Private Key Null\");\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      let loading = this.state.loading;\n      loading.finalize[index] = true;\n      this.setState({\n        error: \"\",\n        loading: loading,\n        waiting: true,\n        message: \"Finalizing\"\n      });\n      console.log(this.state.message);\n      console.log(\"VALUE: \" + this.state.requests[index].value);\n\n      try {\n        const contribution = await this.campaign.methods.contribute();\n        const options = {\n          to: contribution._parent._address,\n          data: contribution.encodeABI(),\n          gas: \"1000000\",\n          value: web3.utils.toWei(this.state.requests[index].value, \"wei\")\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      loading.finalize[index] = false;\n      this.setState({\n        loading,\n        waiting: true\n      });\n      console.log(this.state.requests[index].complete);\n      this.state.requests[index].complete = true;\n      console.log(this.state.requests[index].complete);\n    };\n\n    this.address = this.props.match.params.address;\n    this.campaign = Campaign(this.address);\n    this.state = {\n      requests: [],\n      contributesCount: 0,\n      error: \"\",\n      success: false,\n      waiting: false,\n      loading: {\n        data: false,\n        approve: {},\n        finalize: {}\n      },\n      message: \"\",\n      privateKeyModal: false,\n      status: {}\n    };\n  }\n\n  async componentDidMount() {\n    const contributesCount = await this.campaign.methods.contributersCount().call();\n    const requestsCount = await this.campaign.methods.getRequestsCount().call();\n    let requests = [];\n\n    for (let i = 0; i < requestsCount; i++) {\n      let request = await this.campaign.methods.requests(i).call();\n      requests.push(request);\n    }\n\n    this.setState({\n      requests,\n      contributesCount\n    });\n  }\n\n  renderRequestsRows() {\n    return this.state.requests.map((request, index) => {\n      {\n        this.setState(status[index] = request.complete);\n      }\n      return /*#__PURE__*/React.createElement(Table.Row, {\n        id: \"data\",\n        key: index,\n        disabled: request.complete,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 11\n        }\n      }, index), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 11\n        }\n      }, request.description), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 11\n        }\n      }, web3.utils.fromWei(request.value, \"ether\")), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 11\n        }\n      }, request.recipient), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 11\n        }\n      }, request.approvalsCount, \" / \", request.approvalsCount), request.complete ? null : /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        positive: true,\n        onClick: () => this.onApprove(index),\n        loading: this.state.loading.approve[index],\n        disabled: this.state.loading.approve[index],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 15\n        }\n      }, \"Approve\")), request.complete ? null : /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        color: \"teal\",\n        onClick: () => this.onContribute(index),\n        loading: this.state.loading.finalize[index],\n        disabled: this.state.loading.finalize[index],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 15\n        }\n      }, \"Finalize\")), this.state.status[index] ? /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 15\n        }\n      }, \"Complete\")) : /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 15\n        }\n      }, \"Pending\")));\n    });\n  }\n\n  render() {\n    const waitingMessage = this.state.waiting ? /*#__PURE__*/React.createElement(Message, {\n      warning: true,\n      header: \"Notice!\",\n      content: `${this.state.message} the request might take 25 to 30 seconds. Please be patient.`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const errorMessage = this.state.error ? /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"Error!\",\n      content: this.state.error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const successMessage = this.state.success ? /*#__PURE__*/React.createElement(Message, {\n      success: true,\n      header: \"Congrats!\",\n      content: `${this.state.message} the request is done.`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const fetchingMessage = this.state.requests.length === 0 ? /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 42\n      }\n    }, \"Nothing yet...\") : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? /*#__PURE__*/React.createElement(PrivateKeyModal, {\n      closeModal: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 7\n      }\n    }) : \"\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"listRequest\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        display: \"inline-block\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 15\n      }\n    }, \"Requests List\"))), /*#__PURE__*/React.createElement(Grid.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}/requests/create`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      primary: true,\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 17\n      }\n    }, \"Create Request\")), /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 17\n      }\n    }, \"Back\")), /*#__PURE__*/React.createElement(Table, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Table.Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 21\n      }\n    }, \"ID\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 21\n      }\n    }, \"Description\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 21\n      }\n    }, \"Amount (ether)\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 21\n      }\n    }, \"Recipient\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 21\n      }\n    }, \"Approval Count\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 21\n      }\n    }, \"Approve\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 21\n      }\n    }, \"Finalize\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 21\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(Table.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 17\n      }\n    }, this.renderRequestsRows()))))), fetchingMessage, waitingMessage, errorMessage, successMessage, privateKeyModal);\n  }\n\n}","map":{"version":3,"sources":["/home/pratik/Downloads/crowdfunder/src/components/requests/list.js"],"names":["React","Component","Button","Table","Grid","Message","Link","Campaign","web3","signAndSendTransaction","PrivateKeyModal","decode","CampaignsRequests","constructor","props","state","status","closeModal","setState","privateKeyModal","onApprove","index","success","privateKey","sessionStorage","getItem","console","log","loading","approve","error","waiting","message","approveRequest","campaign","methods","options","to","_parent","_address","data","encodeABI","gas","onContribute","finalize","requests","value","contribution","contribute","utils","toWei","complete","address","match","params","contributesCount","componentDidMount","contributersCount","call","requestsCount","getRequestsCount","i","request","push","renderRequestsRows","map","description","fromWei","recipient","approvalsCount","render","waitingMessage","errorMessage","successMessage","fetchingMessage","length","display"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Button, Table, Grid, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\n//import Layout from '../layout';\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\n\nexport default class CampaignsRequests extends Component {\n  constructor(props) {\n    super(props);\n    this.address = this.props.match.params.address;\n    this.campaign = Campaign(this.address);\n    this.state = {\n      requests: [],\n      contributesCount: 0,\n      error: \"\",\n      success: false,\n      waiting: false,\n      loading: {\n        data: false,\n        approve: {},\n        finalize: {},\n      },\n      message: \"\",\n      privateKeyModal: false,\n      status: {},\n    };\n  }\n\n  state = {\n    status: {},\n  };\n\n  async componentDidMount() {\n    const contributesCount = await this.campaign.methods\n      .contributersCount()\n      .call();\n    const requestsCount = await this.campaign.methods.getRequestsCount().call();\n    let requests = [];\n\n    for (let i = 0; i < requestsCount; i++) {\n      let request = await this.campaign.methods.requests(i).call();\n      requests.push(request);\n    }\n\n    this.setState({ requests, contributesCount });\n  }\n\n  renderRequestsRows() {\n    return this.state.requests.map((request, index) => {\n      {\n        this.setState((status[index] = request.complete));\n      }\n      return (\n        <Table.Row id=\"data\" key={index} disabled={request.complete}>\n          <Table.Cell>{index}</Table.Cell>\n          <Table.Cell>{request.description}</Table.Cell>\n          <Table.Cell>{web3.utils.fromWei(request.value, \"ether\")}</Table.Cell>\n          <Table.Cell>{request.recipient}</Table.Cell>\n          <Table.Cell>\n            {request.approvalsCount} / {request.approvalsCount}\n          </Table.Cell>\n          {request.complete ? null : (\n            <Table.Cell>\n              <Button\n                basic\n                positive\n                onClick={() => this.onApprove(index)}\n                loading={this.state.loading.approve[index]}\n                disabled={this.state.loading.approve[index]}\n              >\n                Approve\n              </Button>\n            </Table.Cell>\n          )}\n\n          {request.complete ? null : (\n            <Table.Cell>\n              <Button\n                basic\n                color=\"teal\"\n                onClick={() => this.onContribute(index)}\n                loading={this.state.loading.finalize[index]}\n                disabled={this.state.loading.finalize[index]}\n              >\n                Finalize\n              </Button>\n            </Table.Cell>\n          )}\n          {this.state.status[index] ? (\n            <Table.Cell>\n              <p>Complete</p>\n            </Table.Cell>\n          ) : (\n            <Table.Cell>\n              <p>Pending</p>\n            </Table.Cell>\n          )}\n        </Table.Row>\n      );\n    });\n  }\n\n  closeModal = () => this.setState({ privateKeyModal: false });\n\n  onApprove = async (index) => {\n    this.setState({ success: false });\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      console.log(\"Private Key Null\");\n      this.setState({ privateKeyModal: true });\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    let loading = this.state.loading;\n    loading.approve[index] = true;\n    this.setState({\n      error: \"\",\n      loading: loading,\n      waiting: true,\n      message: \"Approving\",\n    });\n\n    try {\n      const approveRequest = await this.campaign.methods.approveRequest(index);\n\n      const options = {\n        to: approveRequest._parent._address,\n        data: approveRequest.encodeABI(),\n        gas: \"1000000\",\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    loading.approve[index] = false;\n    this.setState({ loading, waiting: false });\n  };\n\n  // onFinalize = async (index) => {\n  //   this.setState({ success: false });\n\n  //   let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n  //   if (!privateKey) {\n  //     this.setState({ privateKeyModal: true });\n  //     return;\n  //   } else {\n  //     privateKey = decode(privateKey);\n  //   }\n\n  //   let loading = this.state.loading;\n  //   loading.finalize[index] = true;\n  //   this.setState({\n  //     error: \"\",\n  //     loading: loading,\n  //     waiting: true,\n  //     message: \"Finalizing\",\n  //   });\n\n  //   try {\n  //     const finalizeRequest = await this.campaign.methods.finalizeRequest(\n  //       index\n  //     );\n\n  //     const options = {\n  //       to: finalizeRequest._parent._address,\n  //       data: finalizeRequest.encodeABI(),\n  //       gas: \"100000\",\n  //     };\n\n  //     console.log(\"to: \" + finalizeRequest._parent._address);\n  //     await signAndSendTransaction(options, privateKey);\n\n  //     this.setState({ success: true });\n  //   } catch (error) {\n  //     this.setState({ error: error.message });\n  //   }\n\n  //   loading.finalize[index] = false;\n  //   this.setState({ loading, waiting: false });\n  // };\n\n  //Contributing\n  onContribute = async (index) => {\n    this.setState({ success: false });\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      this.setState({ privateKeyModal: true });\n      console.log(\"Private Key Null\");\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    let loading = this.state.loading;\n    loading.finalize[index] = true;\n    this.setState({\n      error: \"\",\n      loading: loading,\n      waiting: true,\n      message: \"Finalizing\",\n    });\n\n    console.log(this.state.message);\n\n    console.log(\"VALUE: \" + this.state.requests[index].value);\n\n    try {\n      const contribution = await this.campaign.methods.contribute();\n\n      const options = {\n        to: contribution._parent._address,\n        data: contribution.encodeABI(),\n        gas: \"1000000\",\n        value: web3.utils.toWei(this.state.requests[index].value, \"wei\"),\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    loading.finalize[index] = false;\n    this.setState({ loading, waiting: true });\n    console.log(this.state.requests[index].complete);\n    this.state.requests[index].complete = true;\n    console.log(this.state.requests[index].complete);\n  };\n\n  render() {\n    const waitingMessage = this.state.waiting ? (\n      <Message\n        warning\n        header=\"Notice!\"\n        content={`${this.state.message} the request might take 25 to 30 seconds. Please be patient.`}\n      />\n    ) : (\n      \"\"\n    );\n    const errorMessage = this.state.error ? (\n      <Message error header=\"Error!\" content={this.state.error} />\n    ) : (\n      \"\"\n    );\n    const successMessage = this.state.success ? (\n      <Message\n        success\n        header=\"Congrats!\"\n        content={`${this.state.message} the request is done.`}\n      />\n    ) : (\n      \"\"\n    );\n    const fetchingMessage =\n      this.state.requests.length === 0 ? <h3>Nothing yet...</h3> : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? (\n      <PrivateKeyModal closeModal={this.closeModal} />\n    ) : (\n      \"\"\n    );\n\n    return (\n      <div className=\"listRequest\">\n        <Grid>\n          <Grid.Row>\n            <Grid.Column>\n              <h3 style={{ display: \"inline-block\" }}>Requests List</h3>\n            </Grid.Column>\n          </Grid.Row>\n          <Grid.Row>\n            <Grid.Column>\n              <Link to={`/campaigns/${this.address}/requests/create`}>\n                <Button primary floated=\"right\">\n                  Create Request\n                </Button>\n              </Link>\n              <Link to={`/campaigns/${this.address}`}>\n                <Button>Back</Button>\n              </Link>\n              <Table>\n                <Table.Header>\n                  <Table.Row>\n                    <Table.HeaderCell>ID</Table.HeaderCell>\n                    <Table.HeaderCell>Description</Table.HeaderCell>\n                    <Table.HeaderCell>Amount (ether)</Table.HeaderCell>\n                    <Table.HeaderCell>Recipient</Table.HeaderCell>\n                    <Table.HeaderCell>Approval Count</Table.HeaderCell>\n                    <Table.HeaderCell>Approve</Table.HeaderCell>\n                    <Table.HeaderCell>Finalize</Table.HeaderCell>\n                    <Table.HeaderCell>Status</Table.HeaderCell>\n                  </Table.Row>\n                </Table.Header>\n                <Table.Body>{this.renderRequestsRows()}</Table.Body>\n              </Table>\n            </Grid.Column>\n          </Grid.Row>\n        </Grid>\n        {fetchingMessage}\n        {waitingMessage}\n        {errorMessage}\n        {successMessage}\n        {privateKeyModal}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}