{"ast":null,"code":"var _jsxFileName = \"/home/pratik/Downloads/crowdfunder/src/components/requests/create.js\";\nimport React, { Component } from \"react\"; // import Layout from '../layout';\n\nimport { Form, Button, Input, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nexport default class CampaignsCreateRequest extends Component {\n  constructor(props) {\n    super(props);\n\n    this.closeModal = () => this.setState({\n      privateKeyModal: false\n    });\n\n    this.onSubmit = async event => {\n      event.preventDefault();\n      this.setState({\n        success: false\n      });\n\n      if (!this.validateInput()) {\n        this.setState({\n          error: \"Please enter correct data!\"\n        });\n        return;\n      }\n\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        console.log(\"Private Key Not Found\");\n        this.setState({\n          privateKeyModal: true\n        });\n        return;\n      } else {\n        console.log(\"private key\" + privateKey);\n        privateKey = decode(privateKey);\n        console.log(privateKey);\n      }\n\n      this.setState({\n        error: \"\",\n        loading: true\n      });\n      let {\n        description,\n        value,\n        recipient\n      } = this.state;\n      value = web3.utils.toWei(value, \"ether\");\n      const campaign = Campaign(this.address);\n\n      try {\n        const makeRequest = await campaign.methods.makeRequest(description, value, recipient);\n        const options = {\n          to: makeRequest._parent._address,\n          data: makeRequest.encodeABI(),\n          gas: \"100000\"\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n\n    this.address = this.props.match.params.address;\n    this.state = {\n      description: \"\",\n      recipient: \"\",\n      value: \"\",\n      error: \"\",\n      success: false,\n      loading: false,\n      privateKeyModal: false\n    };\n  }\n\n  validateInput() {\n    const value = this.state.value.match(/^[0-9.]+$/g);\n    const recipient = this.state.recipient.match(/^0x[a-fA-F0-9]{40}$/g);\n    const description = this.state.description.match(/^.+$/g);\n    return value && recipient && description;\n  }\n\n  render() {\n    const waitingMessage = this.state.loading ? /*#__PURE__*/React.createElement(Message, {\n      warning: true,\n      header: \"Notice!\",\n      content: \"Creating request might take 10 to 15 seconds. Please be patient.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const errorMessage = this.state.error ? /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"Error!\",\n      content: this.state.error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const successMessage = this.state.success ? /*#__PURE__*/React.createElement(Message, {\n      success: true,\n      header: \"Congrats!\",\n      content: \"Your request is created successfully.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? /*#__PURE__*/React.createElement(PrivateKeyModal, {\n      closeModal: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }\n    }) : \"\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"createRequest\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }\n    }, \"Create Request\"), /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      loading: this.state.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Form.Field, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 13\n      }\n    }, \"Description\"), /*#__PURE__*/React.createElement(Input, {\n      onChange: event => this.setState({\n        description: event.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Form.Field, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }\n    }, \"Amount (Value)\"), /*#__PURE__*/React.createElement(Input, {\n      label: \"ether\",\n      labelPosition: \"right\",\n      onChange: event => this.setState({\n        value: event.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Form.Field, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 13\n      }\n    }, \"Recipient Address\"), /*#__PURE__*/React.createElement(Input, {\n      onChange: event => this.setState({\n        recipient: event.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      primary: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }\n    }, \"Create!\"), /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}/requests`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 13\n      }\n    }, \"Back\"))), waitingMessage, errorMessage, successMessage, privateKeyModal);\n  }\n\n}","map":{"version":3,"sources":["/home/pratik/Downloads/crowdfunder/src/components/requests/create.js"],"names":["React","Component","Form","Button","Input","Message","Link","Campaign","web3","signAndSendTransaction","PrivateKeyModal","decode","CampaignsCreateRequest","constructor","props","closeModal","setState","privateKeyModal","onSubmit","event","preventDefault","success","validateInput","error","privateKey","sessionStorage","getItem","console","log","loading","description","value","recipient","state","utils","toWei","campaign","address","makeRequest","methods","options","to","_parent","_address","data","encodeABI","gas","message","match","params","render","waitingMessage","errorMessage","successMessage","target"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n// import Layout from '../layout';\nimport { Form, Button, Input, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\n\nexport default class CampaignsCreateRequest extends Component {\n  constructor(props) {\n    super(props);\n\n    this.address = this.props.match.params.address;\n\n    this.state = {\n      description: \"\",\n      recipient: \"\",\n      value: \"\",\n      error: \"\",\n      success: false,\n      loading: false,\n      privateKeyModal: false,\n    };\n  }\n\n  validateInput() {\n    const value = this.state.value.match(/^[0-9.]+$/g);\n    const recipient = this.state.recipient.match(/^0x[a-fA-F0-9]{40}$/g);\n    const description = this.state.description.match(/^.+$/g);\n    return value && recipient && description;\n  }\n\n  closeModal = () => this.setState({ privateKeyModal: false });\n\n  onSubmit = async (event) => {\n    event.preventDefault();\n\n    this.setState({ success: false });\n\n    if (!this.validateInput()) {\n      this.setState({ error: \"Please enter correct data!\" });\n      return;\n    }\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      console.log(\"Private Key Not Found\");\n      this.setState({ privateKeyModal: true });\n      return;\n    } else {\n      console.log(\"private key\" + privateKey);\n      privateKey = decode(privateKey);\n      console.log(privateKey);\n    }\n\n    this.setState({ error: \"\", loading: true });\n\n    let { description, value, recipient } = this.state;\n    value = web3.utils.toWei(value, \"ether\");\n\n    const campaign = Campaign(this.address);\n\n    try {\n      const makeRequest = await campaign.methods.makeRequest(\n        description,\n        value,\n        recipient\n      );\n\n      const options = {\n        to: makeRequest._parent._address,\n        data: makeRequest.encodeABI(),\n        gas: \"100000\",\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  render() {\n    const waitingMessage = this.state.loading ? (\n      <Message\n        warning\n        header=\"Notice!\"\n        content=\"Creating request might take 10 to 15 seconds. Please be patient.\"\n      />\n    ) : (\n      \"\"\n    );\n    const errorMessage = this.state.error ? (\n      <Message error header=\"Error!\" content={this.state.error} />\n    ) : (\n      \"\"\n    );\n    const successMessage = this.state.success ? (\n      <Message\n        success\n        header=\"Congrats!\"\n        content=\"Your request is created successfully.\"\n      />\n    ) : (\n      \"\"\n    );\n    const privateKeyModal = this.state.privateKeyModal ? (\n      <PrivateKeyModal closeModal={this.closeModal} />\n    ) : (\n      \"\"\n    );\n\n    return (\n      <div className=\"createRequest\">\n        <h3>Create Request</h3>\n        <Form onSubmit={this.onSubmit} loading={this.state.loading}>\n          <Form.Field>\n            <label>Description</label>\n            <Input\n              onChange={(event) =>\n                this.setState({ description: event.target.value })\n              }\n            />\n          </Form.Field>\n          <Form.Field>\n            <label>Amount (Value)</label>\n            <Input\n              label=\"ether\"\n              labelPosition=\"right\"\n              onChange={(event) => this.setState({ value: event.target.value })}\n            />\n          </Form.Field>\n          <Form.Field>\n            <label>Recipient Address</label>\n            <Input\n              onChange={(event) =>\n                this.setState({ recipient: event.target.value })\n              }\n            />\n          </Form.Field>\n          <Button primary>Create!</Button>\n          <Link to={`/campaigns/${this.address}/requests`}>\n            <Button>Back</Button>\n          </Link>\n        </Form>\n        {waitingMessage}\n        {errorMessage}\n        {successMessage}\n        {privateKeyModal}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}