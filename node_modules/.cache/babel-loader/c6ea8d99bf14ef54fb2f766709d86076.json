{"ast":null,"code":"var _jsxFileName = \"/home/pratik/Downloads/crowdfunder/src/components/projects/CreateProject.js\";\nimport React, { Component } from \"react\";\nimport { Message } from \"semantic-ui-react\";\nimport factory from \"../../ethereum/factory-contract\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nimport fire from \"../../config/Firebase\";\n\nclass CreateProject extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      addingproject: false,\n      errormsg: \"\",\n      id: \"\",\n      title: \"\",\n      description: \"\",\n      manager: \"\",\n      developerid: \"\",\n      developername: \"\",\n      privatekey: \"\",\n      mcontri: \"\",\n      requests: 0,\n      contributors: 0,\n      balance: 0,\n      value: \"\",\n      error: \"\",\n      success: false,\n      loading: false,\n      privateKeyModal: false\n    };\n\n    this.closeModal = () => this.setState({\n      privateKeyModal: false\n    });\n\n    this.handleChange = e => {\n      this.setState({\n        [e.target.id]: e.target.value\n      });\n    };\n\n    this.handleSubmit = async e => {\n      //Avoiding Refresh\n      e.preventDefault(); //Initailizing Firestore\n\n      const db = fire.firestore();\n      this.setState({\n        addingproject: false\n      });\n      this.setState({\n        success: false\n      });\n\n      if (!this.validateInput()) {\n        this.setState({\n          error: \"Please enter a correct number!\"\n        });\n        console.log(\"Exiting..\");\n        return;\n      }\n\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        this.setState({\n          privateKeyModal: true\n        });\n        console.log(\"Private Key Null\");\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      this.setState({\n        error: \"\",\n        loading: true\n      });\n\n      try {\n        const createCampaign = await factory.methods.createCampaign(this.state.mcontri);\n        const options = {\n          to: createCampaign._parent._address,\n          data: createCampaign.encodeABI(),\n          gas: \"1000000\"\n        };\n        await signAndSendTransaction(options, privateKey);\n        const campaigns = await factory.methods.getDeployedCampaigns().call();\n        this.setState({\n          campaigns\n        });\n        console.log(this.state.campaigns[this.state.campaigns.length - 1]);\n        this.state.id = this.state.campaigns[this.state.campaigns.length - 1]; //Getting Developer Details\n\n        const cityRef = db.collection(\"users\").doc(fire.auth().currentUser.email);\n        cityRef.get().then(doc => {\n          if (!doc.exists) {\n            console.log(\"No such document!\");\n          } else {\n            console.log(\"Document data:\", doc.data()); // this.setState(this.state.developerid, fire.auth().currentUser.uid);\n\n            this.state.developername = doc.get(\"name\");\n            this.state.developerid = fire.auth().currentUser.uid;\n            const project = {\n              id: this.state.id,\n              title: this.state.title,\n              description: this.state.description,\n              manager: this.state.manager,\n              developerid: this.state.developerid,\n              developername: this.state.developername,\n              mcontri: parseInt(this.state.mcontri),\n              requests: parseInt(this.state.requests),\n              contributors: parseInt(this.state.contributors),\n              balance: parseFloat(this.state.balance)\n            };\n            db.collection(\"projects\").doc(this.state.id).set(project).then(u => {\n              console.log(this.state);\n              console.log(\"Added!\");\n              this.setState({\n                addingproject: true\n              });\n            }).catch(u => {\n              console.log(\"Not Added!\");\n              this.setState({\n                errormsg: u.code\n              });\n            });\n          }\n        }).catch(err => {\n          console.log(\"Error getting document\", err);\n        });\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n  }\n\n  validateInput() {\n    return this.state.mcontri.match(/^[0-9]+$/g);\n  }\n\n  render() {\n    const waitingMessage = this.state.addingproject ? /*#__PURE__*/React.createElement(Message, {\n      warning: true,\n      header: \"Notice!\",\n      content: \"Posting Project! Please be patient.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const successMessage = this.state.success ? /*#__PURE__*/React.createElement(Message, {\n      success: true,\n      header: \"Congrats!\",\n      content: \"Project Added\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const errorMessage = this.state.errormsg ? /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"Error!\",\n      content: this.state.errormsg,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? /*#__PURE__*/React.createElement(PrivateKeyModal, {\n      closeModal: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 7\n      }\n    }) : \"\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      className: \"white\",\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      className: \"grey-text text-darken-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }\n    }, \"Create a New Project\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      id: \"title\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 13\n      }\n    }, \"Project Title\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: \"description\",\n      className: \"materialize-textarea\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"description\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 13\n      }\n    }, \"Project Description\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      id: \"manager\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"manager\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 13\n      }\n    }, \"Manager ID\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      id: \"category\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"category\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 13\n      }\n    }, \"Category\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"number\",\n      id: \"mcontri\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"mcontri\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 13\n      }\n    }, \"Minimum Contribution\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-field\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn blue lighten-1 z-depth-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 13\n      }\n    }, \"Create\")), waitingMessage, successMessage, errorMessage, privateKeyModal));\n  }\n\n}\n\nexport default CreateProject;","map":{"version":3,"sources":["/home/pratik/Downloads/crowdfunder/src/components/projects/CreateProject.js"],"names":["React","Component","Message","factory","signAndSendTransaction","PrivateKeyModal","decode","fire","CreateProject","state","addingproject","errormsg","id","title","description","manager","developerid","developername","privatekey","mcontri","requests","contributors","balance","value","error","success","loading","privateKeyModal","closeModal","setState","handleChange","e","target","handleSubmit","preventDefault","db","firestore","validateInput","console","log","privateKey","sessionStorage","getItem","createCampaign","methods","options","to","_parent","_address","data","encodeABI","gas","campaigns","getDeployedCampaigns","call","length","cityRef","collection","doc","auth","currentUser","email","get","then","exists","uid","project","parseInt","parseFloat","set","u","catch","code","err","message","match","render","waitingMessage","successMessage","errorMessage"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Message } from \"semantic-ui-react\";\nimport factory from \"../../ethereum/factory-contract\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nimport fire from \"../../config/Firebase\";\n\nclass CreateProject extends Component {\n  state = {\n    addingproject: false,\n    errormsg: \"\",\n    id: \"\",\n    title: \"\",\n    description: \"\",\n    manager: \"\",\n    developerid: \"\",\n    developername: \"\",\n    privatekey: \"\",\n    mcontri: \"\",\n    requests: 0,\n    contributors: 0,\n    balance: 0,\n\n    value: \"\",\n    error: \"\",\n    success: false,\n    loading: false,\n    privateKeyModal: false,\n  };\n\n  validateInput() {\n    return this.state.mcontri.match(/^[0-9]+$/g);\n  }\n\n  closeModal = () => this.setState({ privateKeyModal: false });\n\n  handleChange = (e) => {\n    this.setState({\n      [e.target.id]: e.target.value,\n    });\n  };\n\n  handleSubmit = async (e) => {\n    //Avoiding Refresh\n    e.preventDefault();\n\n    //Initailizing Firestore\n    const db = fire.firestore();\n\n    this.setState({ addingproject: false });\n\n    this.setState({ success: false });\n\n    if (!this.validateInput()) {\n      this.setState({ error: \"Please enter a correct number!\" });\n      console.log(\"Exiting..\");\n      return;\n    }\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      this.setState({ privateKeyModal: true });\n      console.log(\"Private Key Null\");\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    this.setState({ error: \"\", loading: true });\n\n    try {\n      const createCampaign = await factory.methods.createCampaign(\n        this.state.mcontri\n      );\n\n      const options = {\n        to: createCampaign._parent._address,\n        data: createCampaign.encodeABI(),\n        gas: \"1000000\",\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      const campaigns = await factory.methods.getDeployedCampaigns().call();\n      this.setState({ campaigns });\n      console.log(this.state.campaigns[this.state.campaigns.length - 1]);\n      this.state.id = this.state.campaigns[this.state.campaigns.length - 1];\n\n      //Getting Developer Details\n      const cityRef = db.collection(\"users\").doc(fire.auth().currentUser.email);\n      cityRef\n        .get()\n        .then((doc) => {\n          if (!doc.exists) {\n            console.log(\"No such document!\");\n          } else {\n            console.log(\"Document data:\", doc.data());\n            // this.setState(this.state.developerid, fire.auth().currentUser.uid);\n            this.state.developername = doc.get(\"name\");\n            this.state.developerid = fire.auth().currentUser.uid;\n            const project = {\n              id: this.state.id,\n              title: this.state.title,\n              description: this.state.description,\n              manager: this.state.manager,\n              developerid: this.state.developerid,\n              developername: this.state.developername,\n              mcontri: parseInt(this.state.mcontri),\n              requests: parseInt(this.state.requests),\n              contributors: parseInt(this.state.contributors),\n              balance: parseFloat(this.state.balance),\n            };\n\n            db.collection(\"projects\")\n              .doc(this.state.id)\n              .set(project)\n              .then((u) => {\n                console.log(this.state);\n                console.log(\"Added!\");\n                this.setState({ addingproject: true });\n              })\n              .catch((u) => {\n                console.log(\"Not Added!\");\n                this.setState({ errormsg: u.code });\n              });\n          }\n        })\n        .catch((err) => {\n          console.log(\"Error getting document\", err);\n        });\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  render() {\n    const waitingMessage = this.state.addingproject ? (\n      <Message\n        warning\n        header=\"Notice!\"\n        content=\"Posting Project! Please be patient.\"\n      />\n    ) : (\n      \"\"\n    );\n\n    const successMessage = this.state.success ? (\n      <Message success header=\"Congrats!\" content=\"Project Added\" />\n    ) : (\n      \"\"\n    );\n\n    const errorMessage = this.state.errormsg ? (\n      <Message error header=\"Error!\" content={this.state.errormsg} />\n    ) : (\n      \"\"\n    );\n\n    const privateKeyModal = this.state.privateKeyModal ? (\n      <PrivateKeyModal closeModal={this.closeModal} />\n    ) : (\n      \"\"\n    );\n\n    return (\n      <div className=\"container\">\n        <form className=\"white\" onSubmit={this.handleSubmit}>\n          <h1 className=\"grey-text text-darken-3\">Create a New Project</h1>\n          <br />\n          {/* <div className=\"input-field\">\n            <input type=\"text\" id=\"id\" onChange={this.handleChange} />\n            <label htmlFor=\"id\">Project ID</label>\n          </div> */}\n          <div className=\"input-field\">\n            <input type=\"text\" id=\"title\" onChange={this.handleChange} />\n            <label htmlFor=\"title\">Project Title</label>\n          </div>\n          <div className=\"input-field\">\n            <textarea\n              id=\"description\"\n              className=\"materialize-textarea\"\n              onChange={this.handleChange}\n            ></textarea>\n            <label htmlFor=\"description\">Project Description</label>\n          </div>\n\n          <div className=\"input-field\">\n            <input type=\"text\" id=\"manager\" onChange={this.handleChange} />\n            <label htmlFor=\"manager\">Manager ID</label>\n          </div>\n\n          {/* <div className=\"input-field\">\n            <input type=\"text\" id=\"privatekey\" onChange={this.handleChange} />\n            <label htmlFor=\"privatekey\">Private Key</label>\n          </div> */}\n\n          <div className=\"input-field\">\n            <input type=\"text\" id=\"category\" onChange={this.handleChange} />\n            <label htmlFor=\"category\">Category</label>\n          </div>\n\n          <div className=\"input-field\">\n            <input type=\"number\" id=\"mcontri\" onChange={this.handleChange} />\n            <label htmlFor=\"mcontri\">Minimum Contribution</label>\n          </div>\n\n          {/* <div className=\"input-field\">\n            <input type=\"number\" id=\"requests\" onChange={this.handleChange} />\n            <label htmlFor=\"requests\">Requests</label>\n          </div>\n\n          <div className=\"input-field\">\n            <input\n              type=\"number\"\n              id=\"contributors\"\n              onChange={this.handleChange}\n            />\n            <label htmlFor=\"contributors\">Contributors</label>\n          </div>\n\n          <div className=\"input-field\">\n            <input\n              type=\"number\"\n              step=\"0.0000000001\"\n              id=\"balance\"\n              onChange={this.handleChange}\n            />\n            <label htmlFor=\"balance\">Balance</label>\n          </div> */}\n\n          <div className=\"input-field\">\n            <button className=\"btn blue lighten-1 z-depth-3\">Create</button>\n          </div>\n          {waitingMessage}\n          {successMessage}\n          {errorMessage}\n          {privateKeyModal}\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default CreateProject;\n"]},"metadata":{},"sourceType":"module"}