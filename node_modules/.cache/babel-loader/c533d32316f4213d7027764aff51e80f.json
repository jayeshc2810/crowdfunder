{"ast":null,"code":"var _jsxFileName = \"/home/pratik/Downloads/crowdfunder/src/components/campaigns/details.js\";\nimport React, { Component } from \"react\";\nimport { Grid, Card, Form, Button, Input, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nimport fire from \"../../config/Firebase\";\nexport default class CampaignsDetails extends Component {\n  constructor(props) {\n    super(props);\n\n    this.closeModal = () => this.setState({\n      privateKeyModal: false\n    });\n\n    this.onContribute = async event => {\n      event.preventDefault();\n      this.setState({\n        success: false\n      });\n\n      if (!this.validateInput()) {\n        this.setState({\n          error: \"Please enter a correct number!\"\n        });\n        return;\n      }\n\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        this.setState({\n          privateKeyModal: true\n        });\n        console.log(\"Private Key Null\");\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      this.setState({\n        error: \"\",\n        loading: true\n      });\n      const campaign = Campaign(this.address);\n\n      try {\n        const contribution = await campaign.methods.contribute();\n        const options = {\n          to: contribution._parent._address,\n          data: contribution.encodeABI(),\n          gas: \"1000000\",\n          value: web3.utils.toWei(this.state.value, \"ether\")\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n\n    this.address = this.props.match.params.address;\n    this.state = {\n      project: null,\n      minimumContribution: \"\",\n      balance: \"\",\n      requestsCount: \"\",\n      contributersCount: \"\",\n      manager: \"\",\n      value: \"\",\n      error: \"\",\n      privateKeyModal: false,\n      success: false,\n      loading: false,\n      developername: \"\",\n      discription: \"\"\n    };\n  }\n\n  async componentDidMount() {\n    const campaign = Campaign(this.address);\n    const summary = await campaign.methods.getSummary().call();\n    this.setState({\n      minimumContribution: summary[0],\n      balance: summary[1],\n      requestsCount: summary[2],\n      contributersCount: summary[3],\n      manager: summary[4]\n    });\n    console.log(\"Lovation \" + this.props.children);\n    const db = fire.firestore();\n    db.collection(\"projects\").doc(this.address).get().then(doc => {\n      if (!doc.exists) {\n        console.log(\"No such document!\");\n      } else {\n        console.log(\"Document data:\", doc.data());\n        this.setState({\n          project: doc.data()\n        });\n        this.setState({\n          developername: doc.data().developername\n        });\n        this.setState({\n          description: doc.data().description\n        });\n        console.log(this.state.project);\n      }\n    }).catch(err => {\n      console.log(\"Error getting document\", err);\n    });\n  }\n\n  renderCards() {\n    if (!this.state.minimumContribution) {\n      return /*#__PURE__*/React.createElement(\"h3\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 14\n        }\n      }, \"Loading...\");\n    }\n\n    const items = [{\n      header: /*#__PURE__*/React.createElement(\"div\", {\n        className: \"header\",\n        style: {\n          overflowWrap: \"break-word\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 11\n        }\n      }, this.state.developername),\n      description: \"The manager creates this campaign and can create requests to withdraw money\",\n      meta: \"Manager Name\"\n    }, {\n      header: /*#__PURE__*/React.createElement(\"div\", {\n        className: \"header\",\n        style: {\n          overflowWrap: \"break-word\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }\n      }, this.state.description),\n      meta: \"Description\"\n    }, {\n      header: /*#__PURE__*/React.createElement(\"div\", {\n        className: \"header\",\n        style: {\n          overflowWrap: \"break-word\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }\n      }, this.state.manager),\n      description: \"The manager creates this campaign and can create requests to withdraw money\",\n      meta: \"Address of Manager\"\n    }, {\n      header: this.state.minimumContribution,\n      description: \"You must contribute at least this much wei to become an approver\",\n      meta: \"Minimum Contribution (wei)\"\n    }, {\n      header: this.state.requestsCount,\n      description: \"A request tries to withdraw money from the contract. Requests must be approved by the contributers\",\n      meta: \"Number of Requests\"\n    }, {\n      header: this.state.contributersCount,\n      description: \"Number of people who have already donated to this campaign\",\n      meta: \"Number of Contributers\"\n    }, {\n      header: web3.utils.fromWei(this.state.balance, \"ether\"),\n      description: \"The balance is how much money this campaign has left to spend\",\n      meta: \"Campaign Balance (ether)\"\n    }];\n    return /*#__PURE__*/React.createElement(Card.Group, {\n      items: items,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 12\n      }\n    });\n  }\n\n  renderContributionForm() {\n    return /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.onContribute,\n      loading: this.state.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Form.Field, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 11\n      }\n    }, \"Amount to Contribute\"), /*#__PURE__*/React.createElement(Input, {\n      label: \"ether\",\n      labelPosition: \"right\",\n      onChange: event => this.setState({\n        value: event.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      primary: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }\n    }, \"Contribute!\"));\n  }\n\n  validateInput() {\n    return this.state.value.match(/^[0-9.]+$/g);\n  }\n\n  render() {\n    const waitingMessage = this.state.loading ? /*#__PURE__*/React.createElement(Message, {\n      warning: true,\n      header: \"Notice!\",\n      content: \"Contribution might take 10 to 15 seconds. Please be patient.\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const errorMessage = this.state.error ? /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"Error!\",\n      content: this.state.error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const successMessage = this.state.success ? /*#__PURE__*/React.createElement(Message, {\n      success: true,\n      header: \"Congrats!\",\n      content: `You just contributed ${this.state.value} ether to this campaign.`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? /*#__PURE__*/React.createElement(PrivateKeyModal, {\n      closeModal: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 7\n      }\n    }) : \"\";\n    return /*#__PURE__*/React.createElement(Grid, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Row, {\n      columns: \"2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      width: \"11\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 13\n      }\n    }), this.renderCards(), /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}/requests`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      primary: true,\n      style: {\n        marginTop: \"15px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 15\n      }\n    }, \"Show Requests\"))), /*#__PURE__*/React.createElement(Grid.Column, {\n      width: \"5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 11\n      }\n    }, this.renderContributionForm(), waitingMessage, errorMessage, successMessage, privateKeyModal)));\n  }\n\n}","map":{"version":3,"sources":["/home/pratik/Downloads/crowdfunder/src/components/campaigns/details.js"],"names":["React","Component","Grid","Card","Form","Button","Input","Message","Link","Campaign","web3","signAndSendTransaction","PrivateKeyModal","decode","fire","CampaignsDetails","constructor","props","closeModal","setState","privateKeyModal","onContribute","event","preventDefault","success","validateInput","error","privateKey","sessionStorage","getItem","console","log","loading","campaign","address","contribution","methods","contribute","options","to","_parent","_address","data","encodeABI","gas","value","utils","toWei","state","message","match","params","project","minimumContribution","balance","requestsCount","contributersCount","manager","developername","discription","componentDidMount","summary","getSummary","call","children","db","firestore","collection","doc","get","then","exists","description","catch","err","renderCards","items","header","overflowWrap","meta","fromWei","renderContributionForm","target","render","waitingMessage","errorMessage","successMessage","marginTop"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,IAAT,EAAeC,IAAf,EAAqBC,IAArB,EAA2BC,MAA3B,EAAmCC,KAAnC,EAA0CC,OAA1C,QAAyD,mBAAzD;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,OAAOC,QAAP,MAAqB,kCAArB;AACA,OAAOC,IAAP,MAAiB,qBAAjB;AACA,SAASC,sBAAT,QAAuC,wBAAvC;AACA,OAAOC,eAAP,MAA4B,wCAA5B;AACA,SAASC,MAAT,QAAuB,YAAvB;AACA,OAAOC,IAAP,MAAiB,uBAAjB;AAEA,eAAe,MAAMC,gBAAN,SAA+Bd,SAA/B,CAAyC;AACtDe,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SA0InBC,UA1ImB,GA0IN,MAAM,KAAKC,QAAL,CAAc;AAAEC,MAAAA,eAAe,EAAE;AAAnB,KAAd,CA1IA;;AAAA,SA4InBC,YA5ImB,GA4IJ,MAAOC,KAAP,IAAiB;AAC9BA,MAAAA,KAAK,CAACC,cAAN;AAEA,WAAKJ,QAAL,CAAc;AAAEK,QAAAA,OAAO,EAAE;AAAX,OAAd;;AAEA,UAAI,CAAC,KAAKC,aAAL,EAAL,EAA2B;AACzB,aAAKN,QAAL,CAAc;AAAEO,UAAAA,KAAK,EAAE;AAAT,SAAd;AACA;AACD;;AAED,UAAIC,UAAU,GAAGC,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAjB;;AAEA,UAAI,CAACF,UAAL,EAAiB;AACf,aAAKR,QAAL,CAAc;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAAd;AACAU,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA;AACD,OAJD,MAIO;AACLJ,QAAAA,UAAU,GAAGd,MAAM,CAACc,UAAD,CAAnB;AACD;;AAED,WAAKR,QAAL,CAAc;AAAEO,QAAAA,KAAK,EAAE,EAAT;AAAaM,QAAAA,OAAO,EAAE;AAAtB,OAAd;AAEA,YAAMC,QAAQ,GAAGxB,QAAQ,CAAC,KAAKyB,OAAN,CAAzB;;AAEA,UAAI;AACF,cAAMC,YAAY,GAAG,MAAMF,QAAQ,CAACG,OAAT,CAAiBC,UAAjB,EAA3B;AAEA,cAAMC,OAAO,GAAG;AACdC,UAAAA,EAAE,EAAEJ,YAAY,CAACK,OAAb,CAAqBC,QADX;AAEdC,UAAAA,IAAI,EAAEP,YAAY,CAACQ,SAAb,EAFQ;AAGdC,UAAAA,GAAG,EAAE,SAHS;AAIdC,UAAAA,KAAK,EAAEnC,IAAI,CAACoC,KAAL,CAAWC,KAAX,CAAiB,KAAKC,KAAL,CAAWH,KAA5B,EAAmC,OAAnC;AAJO,SAAhB;AAOA,cAAMlC,sBAAsB,CAAC2B,OAAD,EAAUX,UAAV,CAA5B;AAEA,aAAKR,QAAL,CAAc;AAAEK,UAAAA,OAAO,EAAE;AAAX,SAAd;AACD,OAbD,CAaE,OAAOE,KAAP,EAAc;AACd,aAAKP,QAAL,CAAc;AAAEO,UAAAA,KAAK,EAAEA,KAAK,CAACuB;AAAf,SAAd;AACD;;AAED,WAAK9B,QAAL,CAAc;AAAEa,QAAAA,OAAO,EAAE;AAAX,OAAd;AACD,KAtLkB;;AAGjB,SAAKE,OAAL,GAAe,KAAKjB,KAAL,CAAWiC,KAAX,CAAiBC,MAAjB,CAAwBjB,OAAvC;AAEA,SAAKc,KAAL,GAAa;AACXI,MAAAA,OAAO,EAAE,IADE;AAEXC,MAAAA,mBAAmB,EAAE,EAFV;AAGXC,MAAAA,OAAO,EAAE,EAHE;AAIXC,MAAAA,aAAa,EAAE,EAJJ;AAKXC,MAAAA,iBAAiB,EAAE,EALR;AAMXC,MAAAA,OAAO,EAAE,EANE;AAOXZ,MAAAA,KAAK,EAAE,EAPI;AAQXnB,MAAAA,KAAK,EAAE,EARI;AASXN,MAAAA,eAAe,EAAE,KATN;AAUXI,MAAAA,OAAO,EAAE,KAVE;AAWXQ,MAAAA,OAAO,EAAE,KAXE;AAYX0B,MAAAA,aAAa,EAAE,EAZJ;AAaXC,MAAAA,WAAW,EAAE;AAbF,KAAb;AAeD;;AAED,QAAMC,iBAAN,GAA0B;AACxB,UAAM3B,QAAQ,GAAGxB,QAAQ,CAAC,KAAKyB,OAAN,CAAzB;AACA,UAAM2B,OAAO,GAAG,MAAM5B,QAAQ,CAACG,OAAT,CAAiB0B,UAAjB,GAA8BC,IAA9B,EAAtB;AAEA,SAAK5C,QAAL,CAAc;AACZkC,MAAAA,mBAAmB,EAAEQ,OAAO,CAAC,CAAD,CADhB;AAEZP,MAAAA,OAAO,EAAEO,OAAO,CAAC,CAAD,CAFJ;AAGZN,MAAAA,aAAa,EAAEM,OAAO,CAAC,CAAD,CAHV;AAIZL,MAAAA,iBAAiB,EAAEK,OAAO,CAAC,CAAD,CAJd;AAKZJ,MAAAA,OAAO,EAAEI,OAAO,CAAC,CAAD;AALJ,KAAd;AAQA/B,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAc,KAAKd,KAAL,CAAW+C,QAArC;AAEA,UAAMC,EAAE,GAAGnD,IAAI,CAACoD,SAAL,EAAX;AACAD,IAAAA,EAAE,CAACE,UAAH,CAAc,UAAd,EACGC,GADH,CACO,KAAKlC,OADZ,EAEGmC,GAFH,GAGGC,IAHH,CAGSF,GAAD,IAAS;AACb,UAAI,CAACA,GAAG,CAACG,MAAT,EAAiB;AACfzC,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACD,OAFD,MAEO;AACLD,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BqC,GAAG,CAAC1B,IAAJ,EAA9B;AACA,aAAKvB,QAAL,CAAc;AAAEiC,UAAAA,OAAO,EAAEgB,GAAG,CAAC1B,IAAJ;AAAX,SAAd;AACA,aAAKvB,QAAL,CAAc;AAAEuC,UAAAA,aAAa,EAAEU,GAAG,CAAC1B,IAAJ,GAAWgB;AAA5B,SAAd;AACA,aAAKvC,QAAL,CAAc;AAAEqD,UAAAA,WAAW,EAAEJ,GAAG,CAAC1B,IAAJ,GAAW8B;AAA1B,SAAd;AACA1C,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKiB,KAAL,CAAWI,OAAvB;AACD;AACF,KAbH,EAcGqB,KAdH,CAcUC,GAAD,IAAS;AACd5C,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsC2C,GAAtC;AACD,KAhBH;AAiBD;;AAEDC,EAAAA,WAAW,GAAG;AACZ,QAAI,CAAC,KAAK3B,KAAL,CAAWK,mBAAhB,EAAqC;AACnC,0BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAP;AACD;;AACD,UAAMuB,KAAK,GAAG,CACZ;AACEC,MAAAA,MAAM,eACJ;AAAK,QAAA,SAAS,EAAC,QAAf;AAAwB,QAAA,KAAK,EAAE;AAAEC,UAAAA,YAAY,EAAE;AAAhB,SAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAK9B,KAAL,CAAWU,aADd,CAFJ;AAMEc,MAAAA,WAAW,EACT,6EAPJ;AAQEO,MAAAA,IAAI,EAAE;AARR,KADY,EAWZ;AACEF,MAAAA,MAAM,eACJ;AAAK,QAAA,SAAS,EAAC,QAAf;AAAwB,QAAA,KAAK,EAAE;AAAEC,UAAAA,YAAY,EAAE;AAAhB,SAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAK9B,KAAL,CAAWwB,WADd,CAFJ;AAMEO,MAAAA,IAAI,EAAE;AANR,KAXY,EAmBZ;AACEF,MAAAA,MAAM,eACJ;AAAK,QAAA,SAAS,EAAC,QAAf;AAAwB,QAAA,KAAK,EAAE;AAAEC,UAAAA,YAAY,EAAE;AAAhB,SAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAK9B,KAAL,CAAWS,OADd,CAFJ;AAMEe,MAAAA,WAAW,EACT,6EAPJ;AAQEO,MAAAA,IAAI,EAAE;AARR,KAnBY,EA6BZ;AACEF,MAAAA,MAAM,EAAE,KAAK7B,KAAL,CAAWK,mBADrB;AAEEmB,MAAAA,WAAW,EACT,kEAHJ;AAIEO,MAAAA,IAAI,EAAE;AAJR,KA7BY,EAmCZ;AACEF,MAAAA,MAAM,EAAE,KAAK7B,KAAL,CAAWO,aADrB;AAEEiB,MAAAA,WAAW,EACT,oGAHJ;AAIEO,MAAAA,IAAI,EAAE;AAJR,KAnCY,EAyCZ;AACEF,MAAAA,MAAM,EAAE,KAAK7B,KAAL,CAAWQ,iBADrB;AAEEgB,MAAAA,WAAW,EACT,4DAHJ;AAIEO,MAAAA,IAAI,EAAE;AAJR,KAzCY,EA+CZ;AACEF,MAAAA,MAAM,EAAEnE,IAAI,CAACoC,KAAL,CAAWkC,OAAX,CAAmB,KAAKhC,KAAL,CAAWM,OAA9B,EAAuC,OAAvC,CADV;AAEEkB,MAAAA,WAAW,EACT,+DAHJ;AAIEO,MAAAA,IAAI,EAAE;AAJR,KA/CY,CAAd;AAuDA,wBAAO,oBAAC,IAAD,CAAM,KAAN;AAAY,MAAA,KAAK,EAAEH,KAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAP;AACD;;AAEDK,EAAAA,sBAAsB,GAAG;AACvB,wBACE,oBAAC,IAAD;AAAM,MAAA,QAAQ,EAAE,KAAK5D,YAArB;AAAmC,MAAA,OAAO,EAAE,KAAK2B,KAAL,CAAWhB,OAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,eAEE,oBAAC,KAAD;AACE,MAAA,KAAK,EAAC,OADR;AAEE,MAAA,aAAa,EAAC,OAFhB;AAGE,MAAA,QAAQ,EAAGV,KAAD,IAAW,KAAKH,QAAL,CAAc;AAAE0B,QAAAA,KAAK,EAAEvB,KAAK,CAAC4D,MAAN,CAAarC;AAAtB,OAAd,CAHvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,CADF,eASE,oBAAC,MAAD;AAAQ,MAAA,OAAO,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBATF,CADF;AAaD;;AAEDpB,EAAAA,aAAa,GAAG;AACd,WAAO,KAAKuB,KAAL,CAAWH,KAAX,CAAiBK,KAAjB,CAAuB,YAAvB,CAAP;AACD;;AAgDDiC,EAAAA,MAAM,GAAG;AACP,UAAMC,cAAc,GAAG,KAAKpC,KAAL,CAAWhB,OAAX,gBACrB,oBAAC,OAAD;AACE,MAAA,OAAO,MADT;AAEE,MAAA,MAAM,EAAC,SAFT;AAGE,MAAA,OAAO,EAAC,8DAHV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADqB,GAOrB,EAPF;AASA,UAAMqD,YAAY,GAAG,KAAKrC,KAAL,CAAWtB,KAAX,gBACnB,oBAAC,OAAD;AAAS,MAAA,KAAK,MAAd;AAAe,MAAA,MAAM,EAAC,QAAtB;AAA+B,MAAA,OAAO,EAAE,KAAKsB,KAAL,CAAWtB,KAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADmB,GAGnB,EAHF;AAKA,UAAM4D,cAAc,GAAG,KAAKtC,KAAL,CAAWxB,OAAX,gBACrB,oBAAC,OAAD;AACE,MAAA,OAAO,MADT;AAEE,MAAA,MAAM,EAAC,WAFT;AAGE,MAAA,OAAO,EAAG,wBAAuB,KAAKwB,KAAL,CAAWH,KAAM,0BAHpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADqB,GAOrB,EAPF;AASA,UAAMzB,eAAe,GAAG,KAAK4B,KAAL,CAAW5B,eAAX,gBACtB,oBAAC,eAAD;AAAiB,MAAA,UAAU,EAAE,KAAKF,UAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADsB,GAGtB,EAHF;AAMA,wBACE,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,GAAN;AAAU,MAAA,OAAO,EAAC,GAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,MAAN;AAAa,MAAA,KAAK,EAAC,IAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,EAGG,KAAKyD,WAAL,EAHH,eAIE,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAG,cAAa,KAAKzC,OAAQ,WAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,MAAD;AAAQ,MAAA,OAAO,MAAf;AAAgB,MAAA,KAAK,EAAE;AAAEqD,QAAAA,SAAS,EAAE;AAAb,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,CAJF,CADF,eAWE,oBAAC,IAAD,CAAM,MAAN;AAAa,MAAA,KAAK,EAAC,GAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKN,sBAAL,EADH,EAEGG,cAFH,EAGGC,YAHH,EAIGC,cAJH,EAKGlE,eALH,CAXF,CADF,CADF;AAuBD;;AA9OqD","sourcesContent":["import React, { Component } from \"react\";\nimport { Grid, Card, Form, Button, Input, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nimport fire from \"../../config/Firebase\";\n\nexport default class CampaignsDetails extends Component {\n  constructor(props) {\n    super(props);\n\n    this.address = this.props.match.params.address;\n\n    this.state = {\n      project: null,\n      minimumContribution: \"\",\n      balance: \"\",\n      requestsCount: \"\",\n      contributersCount: \"\",\n      manager: \"\",\n      value: \"\",\n      error: \"\",\n      privateKeyModal: false,\n      success: false,\n      loading: false,\n      developername: \"\",\n      discription: \"\",\n    };\n  }\n\n  async componentDidMount() {\n    const campaign = Campaign(this.address);\n    const summary = await campaign.methods.getSummary().call();\n\n    this.setState({\n      minimumContribution: summary[0],\n      balance: summary[1],\n      requestsCount: summary[2],\n      contributersCount: summary[3],\n      manager: summary[4],\n    });\n\n    console.log(\"Lovation \" + this.props.children);\n\n    const db = fire.firestore();\n    db.collection(\"projects\")\n      .doc(this.address)\n      .get()\n      .then((doc) => {\n        if (!doc.exists) {\n          console.log(\"No such document!\");\n        } else {\n          console.log(\"Document data:\", doc.data());\n          this.setState({ project: doc.data() });\n          this.setState({ developername: doc.data().developername });\n          this.setState({ description: doc.data().description });\n          console.log(this.state.project);\n        }\n      })\n      .catch((err) => {\n        console.log(\"Error getting document\", err);\n      });\n  }\n\n  renderCards() {\n    if (!this.state.minimumContribution) {\n      return <h3>Loading...</h3>;\n    }\n    const items = [\n      {\n        header: (\n          <div className=\"header\" style={{ overflowWrap: \"break-word\" }}>\n            {this.state.developername}\n          </div>\n        ),\n        description:\n          \"The manager creates this campaign and can create requests to withdraw money\",\n        meta: \"Manager Name\",\n      },\n      {\n        header: (\n          <div className=\"header\" style={{ overflowWrap: \"break-word\" }}>\n            {this.state.description}\n          </div>\n        ),\n        meta: \"Description\",\n      },\n      {\n        header: (\n          <div className=\"header\" style={{ overflowWrap: \"break-word\" }}>\n            {this.state.manager}\n          </div>\n        ),\n        description:\n          \"The manager creates this campaign and can create requests to withdraw money\",\n        meta: \"Address of Manager\",\n      },\n      {\n        header: this.state.minimumContribution,\n        description:\n          \"You must contribute at least this much wei to become an approver\",\n        meta: \"Minimum Contribution (wei)\",\n      },\n      {\n        header: this.state.requestsCount,\n        description:\n          \"A request tries to withdraw money from the contract. Requests must be approved by the contributers\",\n        meta: \"Number of Requests\",\n      },\n      {\n        header: this.state.contributersCount,\n        description:\n          \"Number of people who have already donated to this campaign\",\n        meta: \"Number of Contributers\",\n      },\n      {\n        header: web3.utils.fromWei(this.state.balance, \"ether\"),\n        description:\n          \"The balance is how much money this campaign has left to spend\",\n        meta: \"Campaign Balance (ether)\",\n      },\n    ];\n\n    return <Card.Group items={items} />;\n  }\n\n  renderContributionForm() {\n    return (\n      <Form onSubmit={this.onContribute} loading={this.state.loading}>\n        <Form.Field>\n          <label>Amount to Contribute</label>\n          <Input\n            label=\"ether\"\n            labelPosition=\"right\"\n            onChange={(event) => this.setState({ value: event.target.value })}\n          />\n        </Form.Field>\n        <Button primary>Contribute!</Button>\n      </Form>\n    );\n  }\n\n  validateInput() {\n    return this.state.value.match(/^[0-9.]+$/g);\n  }\n\n  closeModal = () => this.setState({ privateKeyModal: false });\n\n  onContribute = async (event) => {\n    event.preventDefault();\n\n    this.setState({ success: false });\n\n    if (!this.validateInput()) {\n      this.setState({ error: \"Please enter a correct number!\" });\n      return;\n    }\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      this.setState({ privateKeyModal: true });\n      console.log(\"Private Key Null\");\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    this.setState({ error: \"\", loading: true });\n\n    const campaign = Campaign(this.address);\n\n    try {\n      const contribution = await campaign.methods.contribute();\n\n      const options = {\n        to: contribution._parent._address,\n        data: contribution.encodeABI(),\n        gas: \"1000000\",\n        value: web3.utils.toWei(this.state.value, \"ether\"),\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  render() {\n    const waitingMessage = this.state.loading ? (\n      <Message\n        warning\n        header=\"Notice!\"\n        content=\"Contribution might take 10 to 15 seconds. Please be patient.\"\n      />\n    ) : (\n      \"\"\n    );\n    const errorMessage = this.state.error ? (\n      <Message error header=\"Error!\" content={this.state.error} />\n    ) : (\n      \"\"\n    );\n    const successMessage = this.state.success ? (\n      <Message\n        success\n        header=\"Congrats!\"\n        content={`You just contributed ${this.state.value} ether to this campaign.`}\n      />\n    ) : (\n      \"\"\n    );\n    const privateKeyModal = this.state.privateKeyModal ? (\n      <PrivateKeyModal closeModal={this.closeModal} />\n    ) : (\n      \"\"\n    );\n\n    return (\n      <Grid>\n        <Grid.Row columns=\"2\">\n          <Grid.Column width=\"11\">\n            <br />\n            <br />\n            {this.renderCards()}\n            <Link to={`/campaigns/${this.address}/requests`}>\n              <Button primary style={{ marginTop: \"15px\" }}>\n                Show Requests\n              </Button>\n            </Link>\n          </Grid.Column>\n          <Grid.Column width=\"5\">\n            {this.renderContributionForm()}\n            {waitingMessage}\n            {errorMessage}\n            {successMessage}\n            {privateKeyModal}\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}