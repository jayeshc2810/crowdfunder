{"ast":null,"code":"var _jsxFileName = \"/home/pratik/Downloads/crowdfunder/src/components/requests/list.js\";\nimport React, { Component } from \"react\";\nimport { Button, Table, Grid, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\"; //import Layout from '../layout';\n\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\nexport default class CampaignsRequests extends Component {\n  constructor(props) {\n    super(props);\n\n    this.closeModal = () => this.setState({\n      privateKeyModal: false\n    });\n\n    this.onApprove = async index => {\n      this.setState({\n        success: false\n      });\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        console.log(\"Private Key Null\");\n        this.setState({\n          privateKeyModal: true\n        });\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      let loading = this.state.loading;\n      loading.approve[index] = true;\n      this.setState({\n        error: \"\",\n        loading: loading,\n        waiting: true,\n        message: \"Approving\"\n      });\n\n      try {\n        const approveRequest = await this.campaign.methods.approveRequest(index);\n        const options = {\n          to: approveRequest._parent._address,\n          data: approveRequest.encodeABI(),\n          gas: \"1000000\"\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      loading.approve[index] = false;\n      this.setState({\n        loading,\n        waiting: false\n      });\n    };\n\n    this.onFinalize = async index => {\n      this.setState({\n        success: false\n      });\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        this.setState({\n          privateKeyModal: true\n        });\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      let loading = this.state.loading;\n      loading.finalize[index] = true;\n      this.setState({\n        error: \"\",\n        loading: loading,\n        waiting: true,\n        message: \"Finalizing\"\n      });\n\n      try {\n        const finalizeRequest = await this.campaign.methods.finalizeRequest(index);\n        const options = {\n          to: finalizeRequest._parent._address,\n          data: finalizeRequest.encodeABI(),\n          gas: \"100000\"\n        };\n        console.log(\"to: \" + finalizeRequest._parent._address);\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      loading.finalize[index] = false;\n      this.setState({\n        loading,\n        waiting: false\n      });\n    };\n\n    this.onContribute = async index => {\n      // e.preventDefault();\n      this.setState({\n        success: false\n      }); // if (!this.validateInput()) {\n      //   this.setState({ error: \"Please enter a correct number!\" });\n      //   return;\n      // }\n\n      let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n      if (!privateKey) {\n        this.setState({\n          privateKeyModal: true\n        });\n        console.log(\"Private Key Null\");\n        return;\n      } else {\n        privateKey = decode(privateKey);\n      }\n\n      let loading = this.state.loading;\n      loading.finalize[index] = true;\n      this.setState({\n        error: \"\",\n        loading: loading,\n        waiting: true,\n        message: \"Finalizing\"\n      });\n      console.log(this.state.message); // const campaign = Campaign(this.address);\n\n      const val = this.state.requests.map((request, index) => {\n        return request.value;\n      });\n      console.log(web3.utils.toWei(val));\n\n      try {\n        const contribution = await this.campaign.methods.contribute();\n        const options = {\n          to: contribution._parent._address,\n          data: contribution.encodeABI(),\n          gas: \"1000000\",\n          // value: web3.utils.toWei(this.state.value, \"ether\"),\n          value: web3.utils.toWei(this.state.requests.map(index).value, \"ether\")\n        };\n        await signAndSendTransaction(options, privateKey);\n        this.setState({\n          success: true\n        });\n      } catch (error) {\n        this.setState({\n          error: error.message\n        });\n      }\n\n      loading.finalize[index] = false;\n      this.setState({\n        loading,\n        waiting: false\n      });\n    };\n\n    this.address = this.props.match.params.address;\n    this.campaign = Campaign(this.address);\n    this.state = {\n      requests: [],\n      contributesCount: 0,\n      error: \"\",\n      success: false,\n      waiting: false,\n      loading: {\n        data: false,\n        approve: {},\n        finalize: {}\n      },\n      message: \"\",\n      privateKeyModal: false\n    };\n  }\n\n  async componentDidMount() {\n    const contributesCount = await this.campaign.methods.contributersCount().call();\n    const requestsCount = await this.campaign.methods.getRequestsCount().call();\n    let requests = [];\n\n    for (let i = 0; i < requestsCount; i++) {\n      let request = await this.campaign.methods.requests(i).call();\n      requests.push(request);\n    }\n\n    this.setState({\n      requests,\n      contributesCount\n    });\n  }\n\n  renderRequestsRows() {\n    return this.state.requests.map((request, index) => {\n      return /*#__PURE__*/React.createElement(Table.Row, {\n        key: index,\n        disabled: request.complete,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 51,\n          columnNumber: 11\n        }\n      }, index), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 52,\n          columnNumber: 11\n        }\n      }, request.description), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 11\n        }\n      }, web3.utils.fromWei(request.value, \"ether\")), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 11\n        }\n      }, request.recipient), /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 11\n        }\n      }, request.approvalsCount, \" / \", this.state.contributesCount), request.complete ? null : /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        positive: true,\n        onClick: () => this.onApprove(index),\n        loading: this.state.loading.approve[index],\n        disabled: this.state.loading.approve[index],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 15\n        }\n      }, \"Approve\")), request.complete ? null : /*#__PURE__*/React.createElement(Table.Cell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        color: \"teal\",\n        onClick: () => this.onContribute(index),\n        loading: this.state.loading.finalize[index],\n        disabled: this.state.loading.finalize[index],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 15\n        }\n      }, \"Finalize\")));\n    });\n  }\n\n  render() {\n    const waitingMessage = this.state.waiting ? /*#__PURE__*/React.createElement(Message, {\n      warning: true,\n      header: \"Notice!\",\n      content: `${this.state.message} the request might take 25 to 30 seconds. Please be patient.`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const errorMessage = this.state.error ? /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"Error!\",\n      content: this.state.error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const successMessage = this.state.success ? /*#__PURE__*/React.createElement(Message, {\n      success: true,\n      header: \"Congrats!\",\n      content: `${this.state.message} the request is done.`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 7\n      }\n    }) : \"\";\n    const fetchingMessage = this.state.requests.length === 0 ? /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 42\n      }\n    }, \"Nothing yet...\") : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? /*#__PURE__*/React.createElement(PrivateKeyModal, {\n      closeModal: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 7\n      }\n    }) : \"\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"listRequest\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        display: \"inline-block\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 15\n      }\n    }, \"Requests List\"))), /*#__PURE__*/React.createElement(Grid.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}/requests/create`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      primary: true,\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 17\n      }\n    }, \"Create Request\")), /*#__PURE__*/React.createElement(Link, {\n      to: `/campaigns/${this.address}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 17\n      }\n    }, \"Back\")), /*#__PURE__*/React.createElement(Table, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Table.Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 21\n      }\n    }, \"ID\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 21\n      }\n    }, \"Description\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 21\n      }\n    }, \"Amount (ether)\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 21\n      }\n    }, \"Recipient\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 21\n      }\n    }, \"Approval Count\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 21\n      }\n    }, \"Approve\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 21\n      }\n    }, \"Finalize\"))), /*#__PURE__*/React.createElement(Table.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 17\n      }\n    }, this.renderRequestsRows()))))), fetchingMessage, waitingMessage, errorMessage, successMessage, privateKeyModal);\n  }\n\n}","map":{"version":3,"sources":["/home/pratik/Downloads/crowdfunder/src/components/requests/list.js"],"names":["React","Component","Button","Table","Grid","Message","Link","Campaign","web3","signAndSendTransaction","PrivateKeyModal","decode","CampaignsRequests","constructor","props","closeModal","setState","privateKeyModal","onApprove","index","success","privateKey","sessionStorage","getItem","console","log","loading","state","approve","error","waiting","message","approveRequest","campaign","methods","options","to","_parent","_address","data","encodeABI","gas","onFinalize","finalize","finalizeRequest","onContribute","val","requests","map","request","value","utils","toWei","contribution","contribute","address","match","params","contributesCount","componentDidMount","contributersCount","call","requestsCount","getRequestsCount","i","push","renderRequestsRows","complete","description","fromWei","recipient","approvalsCount","render","waitingMessage","errorMessage","successMessage","fetchingMessage","length","display"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Button, Table, Grid, Message } from \"semantic-ui-react\";\nimport { Link } from \"react-router-dom\";\n//import Layout from '../layout';\nimport Campaign from \"../../ethereum/campaign-contract\";\nimport web3 from \"../../ethereum/web3\";\nimport { signAndSendTransaction } from \"../../ethereum/helpers\";\nimport PrivateKeyModal from \"../private-key-modal/private-key-modal\";\nimport { decode } from \"../helpers\";\n\nexport default class CampaignsRequests extends Component {\n  constructor(props) {\n    super(props);\n    this.address = this.props.match.params.address;\n    this.campaign = Campaign(this.address);\n    this.state = {\n      requests: [],\n      contributesCount: 0,\n      error: \"\",\n      success: false,\n      waiting: false,\n      loading: {\n        data: false,\n        approve: {},\n        finalize: {},\n      },\n      message: \"\",\n      privateKeyModal: false,\n    };\n  }\n\n  async componentDidMount() {\n    const contributesCount = await this.campaign.methods\n      .contributersCount()\n      .call();\n    const requestsCount = await this.campaign.methods.getRequestsCount().call();\n    let requests = [];\n\n    for (let i = 0; i < requestsCount; i++) {\n      let request = await this.campaign.methods.requests(i).call();\n      requests.push(request);\n    }\n\n    this.setState({ requests, contributesCount });\n  }\n\n  renderRequestsRows() {\n    return this.state.requests.map((request, index) => {\n      return (\n        <Table.Row key={index} disabled={request.complete}>\n          <Table.Cell>{index}</Table.Cell>\n          <Table.Cell>{request.description}</Table.Cell>\n          <Table.Cell>{web3.utils.fromWei(request.value, \"ether\")}</Table.Cell>\n          <Table.Cell>{request.recipient}</Table.Cell>\n          <Table.Cell>\n            {request.approvalsCount} / {this.state.contributesCount}\n          </Table.Cell>\n          {request.complete ? null : (\n            <Table.Cell>\n              <Button\n                basic\n                positive\n                onClick={() => this.onApprove(index)}\n                loading={this.state.loading.approve[index]}\n                disabled={this.state.loading.approve[index]}\n              >\n                Approve\n              </Button>\n            </Table.Cell>\n          )}\n          {request.complete ? null : (\n            <Table.Cell>\n              <Button\n                basic\n                color=\"teal\"\n                onClick={() => this.onContribute(index)}\n                loading={this.state.loading.finalize[index]}\n                disabled={this.state.loading.finalize[index]}\n              >\n                Finalize\n              </Button>\n            </Table.Cell>\n          )}\n        </Table.Row>\n      );\n    });\n  }\n\n  closeModal = () => this.setState({ privateKeyModal: false });\n\n  onApprove = async (index) => {\n    this.setState({ success: false });\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      console.log(\"Private Key Null\");\n      this.setState({ privateKeyModal: true });\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    let loading = this.state.loading;\n    loading.approve[index] = true;\n    this.setState({\n      error: \"\",\n      loading: loading,\n      waiting: true,\n      message: \"Approving\",\n    });\n\n    try {\n      const approveRequest = await this.campaign.methods.approveRequest(index);\n\n      const options = {\n        to: approveRequest._parent._address,\n        data: approveRequest.encodeABI(),\n        gas: \"1000000\",\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    loading.approve[index] = false;\n    this.setState({ loading, waiting: false });\n  };\n\n  onFinalize = async (index) => {\n    this.setState({ success: false });\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      this.setState({ privateKeyModal: true });\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    let loading = this.state.loading;\n    loading.finalize[index] = true;\n    this.setState({\n      error: \"\",\n      loading: loading,\n      waiting: true,\n      message: \"Finalizing\",\n    });\n\n    try {\n      const finalizeRequest = await this.campaign.methods.finalizeRequest(\n        index\n      );\n\n      const options = {\n        to: finalizeRequest._parent._address,\n        data: finalizeRequest.encodeABI(),\n        gas: \"100000\",\n      };\n\n      console.log(\"to: \" + finalizeRequest._parent._address);\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    loading.finalize[index] = false;\n    this.setState({ loading, waiting: false });\n  };\n\n  //Contributing\n  onContribute = async (index) => {\n    // e.preventDefault();\n\n    this.setState({ success: false });\n\n    // if (!this.validateInput()) {\n    //   this.setState({ error: \"Please enter a correct number!\" });\n    //   return;\n    // }\n\n    let privateKey = sessionStorage.getItem(\"pkencoded\");\n\n    if (!privateKey) {\n      this.setState({ privateKeyModal: true });\n      console.log(\"Private Key Null\");\n      return;\n    } else {\n      privateKey = decode(privateKey);\n    }\n\n    let loading = this.state.loading;\n    loading.finalize[index] = true;\n    this.setState({\n      error: \"\",\n      loading: loading,\n      waiting: true,\n      message: \"Finalizing\",\n    });\n\n    console.log(this.state.message);\n    // const campaign = Campaign(this.address);\n\n    const val = this.state.requests.map((request, index) => {\n      return request.value;\n    });\n\n    console.log(web3.utils.toWei(val));\n\n    try {\n      const contribution = await this.campaign.methods.contribute();\n\n      const options = {\n        to: contribution._parent._address,\n        data: contribution.encodeABI(),\n        gas: \"1000000\",\n        // value: web3.utils.toWei(this.state.value, \"ether\"),\n        value: web3.utils.toWei(this.state.requests.map(index).value, \"ether\"),\n      };\n\n      await signAndSendTransaction(options, privateKey);\n\n      this.setState({ success: true });\n    } catch (error) {\n      this.setState({ error: error.message });\n    }\n\n    loading.finalize[index] = false;\n    this.setState({ loading, waiting: false });\n  };\n\n  render() {\n    const waitingMessage = this.state.waiting ? (\n      <Message\n        warning\n        header=\"Notice!\"\n        content={`${this.state.message} the request might take 25 to 30 seconds. Please be patient.`}\n      />\n    ) : (\n      \"\"\n    );\n    const errorMessage = this.state.error ? (\n      <Message error header=\"Error!\" content={this.state.error} />\n    ) : (\n      \"\"\n    );\n    const successMessage = this.state.success ? (\n      <Message\n        success\n        header=\"Congrats!\"\n        content={`${this.state.message} the request is done.`}\n      />\n    ) : (\n      \"\"\n    );\n    const fetchingMessage =\n      this.state.requests.length === 0 ? <h3>Nothing yet...</h3> : \"\";\n    const privateKeyModal = this.state.privateKeyModal ? (\n      <PrivateKeyModal closeModal={this.closeModal} />\n    ) : (\n      \"\"\n    );\n\n    return (\n      <div className=\"listRequest\">\n        <Grid>\n          <Grid.Row>\n            <Grid.Column>\n              <h3 style={{ display: \"inline-block\" }}>Requests List</h3>\n            </Grid.Column>\n          </Grid.Row>\n          <Grid.Row>\n            <Grid.Column>\n              <Link to={`/campaigns/${this.address}/requests/create`}>\n                <Button primary floated=\"right\">\n                  Create Request\n                </Button>\n              </Link>\n              <Link to={`/campaigns/${this.address}`}>\n                <Button>Back</Button>\n              </Link>\n              <Table>\n                <Table.Header>\n                  <Table.Row>\n                    <Table.HeaderCell>ID</Table.HeaderCell>\n                    <Table.HeaderCell>Description</Table.HeaderCell>\n                    <Table.HeaderCell>Amount (ether)</Table.HeaderCell>\n                    <Table.HeaderCell>Recipient</Table.HeaderCell>\n                    <Table.HeaderCell>Approval Count</Table.HeaderCell>\n                    <Table.HeaderCell>Approve</Table.HeaderCell>\n                    <Table.HeaderCell>Finalize</Table.HeaderCell>\n                  </Table.Row>\n                </Table.Header>\n                <Table.Body>{this.renderRequestsRows()}</Table.Body>\n              </Table>\n            </Grid.Column>\n          </Grid.Row>\n        </Grid>\n        {fetchingMessage}\n        {waitingMessage}\n        {errorMessage}\n        {successMessage}\n        {privateKeyModal}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}