{"ast":null,"code":"var parseKeys = require('parse-asn1');\n\nvar mgf = require('./mgf');\n\nvar xor = require('./xor');\n\nvar bn = require('bn.js');\n\nvar crt = require('browserify-rsa');\n\nvar createHash = require('create-hash');\n\nvar withPublic = require('./withPublic');\n\nmodule.exports = function privateDecrypt(private_key, enc, reverse) {\n  var padding;\n\n  if (private_key.padding) {\n    padding = private_key.padding;\n  } else if (reverse) {\n    padding = 1;\n  } else {\n    padding = 4;\n  }\n\n  var key = parseKeys(private_key);\n  var k = key.modulus.byteLength();\n\n  if (enc.length > k || new bn(enc).cmp(key.modulus) >= 0) {\n    throw new Error('decryption error');\n  }\n\n  var msg;\n\n  if (reverse) {\n    msg = withPublic(new bn(enc), key);\n  } else {\n    msg = crt(enc, key);\n  }\n\n  var zBuffer = new Buffer(k - msg.length);\n  zBuffer.fill(0);\n  msg = Buffer.concat([zBuffer, msg], k);\n\n  if (padding === 4) {\n    return oaep(key, msg);\n  } else if (padding === 1) {\n    return pkcs1(key, msg, reverse);\n  } else if (padding === 3) {\n    return msg;\n  } else {\n    throw new Error('unknown padding');\n  }\n};\n\nfunction oaep(key, msg) {\n  var n = key.modulus;\n  var k = key.modulus.byteLength();\n  var mLen = msg.length;\n  var iHash = createHash('sha1').update(new Buffer('')).digest();\n  var hLen = iHash.length;\n  var hLen2 = 2 * hLen;\n\n  if (msg[0] !== 0) {\n    throw new Error('decryption error');\n  }\n\n  var maskedSeed = msg.slice(1, hLen + 1);\n  var maskedDb = msg.slice(hLen + 1);\n  var seed = xor(maskedSeed, mgf(maskedDb, hLen));\n  var db = xor(maskedDb, mgf(seed, k - hLen - 1));\n\n  if (compare(iHash, db.slice(0, hLen))) {\n    throw new Error('decryption error');\n  }\n\n  var i = hLen;\n\n  while (db[i] === 0) {\n    i++;\n  }\n\n  if (db[i++] !== 1) {\n    throw new Error('decryption error');\n  }\n\n  return db.slice(i);\n}\n\nfunction pkcs1(key, msg, reverse) {\n  var p1 = msg.slice(0, 2);\n  var i = 2;\n  var status = 0;\n\n  while (msg[i++] !== 0) {\n    if (i >= msg.length) {\n      status++;\n      break;\n    }\n  }\n\n  var ps = msg.slice(2, i - 1);\n  var p2 = msg.slice(i - 1, i);\n\n  if (p1.toString('hex') !== '0002' && !reverse || p1.toString('hex') !== '0001' && reverse) {\n    status++;\n  }\n\n  if (ps.length < 8) {\n    status++;\n  }\n\n  if (status) {\n    throw new Error('decryption error');\n  }\n\n  return msg.slice(i);\n}\n\nfunction compare(a, b) {\n  a = new Buffer(a);\n  b = new Buffer(b);\n  var dif = 0;\n  var len = a.length;\n\n  if (a.length !== b.length) {\n    dif++;\n    len = Math.min(a.length, b.length);\n  }\n\n  var i = -1;\n\n  while (++i < len) {\n    dif += a[i] ^ b[i];\n  }\n\n  return dif;\n}","map":{"version":3,"sources":["/home/pratik/Final Project/crowdfunder/node_modules/public-encrypt/privateDecrypt.js"],"names":["parseKeys","require","mgf","xor","bn","crt","createHash","withPublic","module","exports","privateDecrypt","private_key","enc","reverse","padding","key","k","modulus","byteLength","length","cmp","Error","msg","zBuffer","Buffer","fill","concat","oaep","pkcs1","n","mLen","iHash","update","digest","hLen","hLen2","maskedSeed","slice","maskedDb","seed","db","compare","i","p1","status","ps","p2","toString","a","b","dif","len","Math","min"],"mappings":"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","sourcesContent":["var parseKeys = require('parse-asn1');\nvar mgf = require('./mgf');\nvar xor = require('./xor');\nvar bn = require('bn.js');\nvar crt = require('browserify-rsa');\nvar createHash = require('create-hash');\nvar withPublic = require('./withPublic');\nmodule.exports = function privateDecrypt(private_key, enc, reverse) {\n  var padding;\n  if (private_key.padding) {\n    padding = private_key.padding;\n  } else if (reverse) {\n    padding = 1;\n  } else {\n    padding = 4;\n  }\n  \n  var key = parseKeys(private_key);\n  var k = key.modulus.byteLength();\n  if (enc.length > k || new bn(enc).cmp(key.modulus) >= 0) {\n    throw new Error('decryption error');\n  }\n  var msg;\n  if (reverse) {\n    msg = withPublic(new bn(enc), key);\n  } else {\n    msg = crt(enc, key);\n  }\n  var zBuffer = new Buffer(k - msg.length);\n  zBuffer.fill(0);\n  msg = Buffer.concat([zBuffer, msg], k);\n  if (padding === 4) {\n    return oaep(key, msg);\n  } else if (padding === 1) {\n    return pkcs1(key, msg, reverse);\n  } else if (padding === 3) {\n    return msg;\n  } else {\n    throw new Error('unknown padding');\n  }\n};\n\nfunction oaep(key, msg){\n  var n = key.modulus;\n  var k = key.modulus.byteLength();\n  var mLen = msg.length;\n  var iHash = createHash('sha1').update(new Buffer('')).digest();\n  var hLen = iHash.length;\n  var hLen2 = 2 * hLen;\n  if (msg[0] !== 0) {\n    throw new Error('decryption error');\n  }\n  var maskedSeed = msg.slice(1, hLen + 1);\n  var maskedDb =  msg.slice(hLen + 1);\n  var seed = xor(maskedSeed, mgf(maskedDb, hLen));\n  var db = xor(maskedDb, mgf(seed, k - hLen - 1));\n  if (compare(iHash, db.slice(0, hLen))) {\n    throw new Error('decryption error');\n  }\n  var i = hLen;\n  while (db[i] === 0) {\n    i++;\n  }\n  if (db[i++] !== 1) {\n    throw new Error('decryption error');\n  }\n  return db.slice(i);\n}\n\nfunction pkcs1(key, msg, reverse){\n  var p1 = msg.slice(0, 2);\n  var i = 2;\n  var status = 0;\n  while (msg[i++] !== 0) {\n    if (i >= msg.length) {\n      status++;\n      break;\n    }\n  }\n  var ps = msg.slice(2, i - 1);\n  var p2 = msg.slice(i - 1, i);\n\n  if ((p1.toString('hex') !== '0002' && !reverse) || (p1.toString('hex') !== '0001' && reverse)){\n    status++;\n  }\n  if (ps.length < 8) {\n    status++;\n  }\n  if (status) {\n    throw new Error('decryption error');\n  }\n  return  msg.slice(i);\n}\nfunction compare(a, b){\n  a = new Buffer(a);\n  b = new Buffer(b);\n  var dif = 0;\n  var len = a.length;\n  if (a.length !== b.length) {\n    dif++;\n    len = Math.min(a.length, b.length);\n  }\n  var i = -1;\n  while (++i < len) {\n    dif += (a[i] ^ b[i]);\n  }\n  return dif;\n}"]},"metadata":{},"sourceType":"script"}